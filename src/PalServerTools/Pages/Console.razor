@page "/console"

<PageTitle>控制台</PageTitle>

@using PalServerTools.Data
@inject ConsoleService consoleService
@inject PalRconService palRconService

<h1>控制台</h1>

<div class="mb-3 row">
    <div class="col-sm-12">
        <textarea class="form-control" aria-label="With textarea" style="height:calc(100vh - 200px)" readonly>@foreach (var msg in consoleService.msgList)
            {
                @(msg + "\n")
            }</textarea>
    </div>
</div>
<div class="mb-3 row">
    <div class="col-12">
        <label class="visually-hidden" for="inlineFormInputGroupUsername">Username</label>
        <div class="input-group input-group-sm">
            <span class="input-group-text">
                <select class="form-select form-select-sm" id="inputGroupSelect02" @bind="cmdType">
                    <option value="Broadcast">Broadcast</option>
                    <option value="Shutdown">Shutdown</option>
                    <option value="DoExit">DoExit</option>
                    <option value="KickPlayer">KickPlayer</option>
                    <option value="BanPlayer">BanPlayer</option>
                    <option value="TeleportToPlayer">TeleportToPlayer</option>
                    <option value="TeleportToMe">TeleportToMe</option>
                    <option value="ShowPlayers">ShowPlayers</option>
                    <option value="Info">Info</option>
                    <option value="Save">Save</option>
                    <option value="" selected>自定义</option>
                </select>
            </span>
            <input type="text" class="form-control" id="inlineFormInputGroupUsername" placeholder="输入命令..." @bind="cmd">
            <button class="btn btn-primary" @onclick="SendCommand">
                发送
            </button>
        </div>
    </div>
</div>

@code {
    private string cmdType = "";
    private string cmd = "";

    public async Task SendCommand()
    {
        string command = $"{cmdType}{(string.IsNullOrWhiteSpace(cmdType) ? "" : " ")}{cmd}";
        if (!string.IsNullOrWhiteSpace(command))
        {
            consoleService.msgList.Add(command);
            var msg = await palRconService.ExecuteCommand(command);
            consoleService.msgList.Add(msg);
            this.StateHasChanged();
        }
    }
}
